var DEFAULT_SORT="top",DEFAULT_PAGE_LIMIT=5,SORT_OPTIONS={top:function(a,b){var c=this.state.votes;return(c[b._id]||[]).length-(c[a._id]||[]).length},"new":function(a,b){var c=new Date(a.date)>new Date(b.date);return c?-1:1}},SortControl=React.createClass({displayName:"SortControl",getInitialState:function(){return{selected:DEFAULT_SORT}},handleClick:function(a){this.setState({selected:a}),$("#sort-method").val(a).trigger("change")},getBtn:function(a){return"btn"+(this.state.selected==a?" btn-primary":" btn-default")},render:function(){return React.createElement("div",null,React.createElement("p",null,"SORT BY"),React.createElement("button",{onClick:this.handleClick.bind(this,"new"),className:this.getBtn("new")},"New"),React.createElement("button",{onClick:this.handleClick.bind(this,"top"),className:this.getBtn("top")},"Top"),React.createElement("input",{id:"sort-method",type:"hidden"}))}});React.render(React.createElement(SortControl,null),document.getElementById("sort"));var ProjectImage=React.createClass({displayName:"ProjectImage",render:function(){var a=this.props.src?"/uploads/"+this.props.src:"/img/suw-logo.png";return React.createElement("div",{className:"img-container col-sm-3 hidden-xs hidden-sm"},React.createElement("img",{className:"project-logo",src:a}))}}),VoteButton=React.createClass({displayName:"VoteButton",getInitialState:function(){var a=this.props.user,b=!1;return a&&(b=1===this.props.votes.filter(function(b){return b.user._id===a._id}).length),{numVotes:this.props.votes.length||0,voted:b}},componentDidMount:function(){$(".cannot-vote").tooltip({title:"You must sign in to vote on projects!",placement:"bottom"})},handleClick:function(){this.props.user&&$.get("/api/project/"+this.props.project._id+"/vote").done(function(a){this.setState({numVotes:this.state.numVotes+(a.voteStatus?1:-1),voted:a.voteStatus})}.bind(this))},render:function(){var a=this.props.user,b=this.state.numVotes,c="votes";return c+=this.state.voted?" user-voted":" user-not-voted",c+=a?" can-vote":" cannot-vote",React.createElement("div",{onClick:this.handleClick,className:c},React.createElement("span",{className:"glyphicon glyphicon-heart"}),React.createElement("span",{className:"vote-count"}," ",b>0?b:""))}}),ProjectInfo=React.createClass({displayName:"ProjectInfo",getDate:function(a){var b=(new Date-new Date(a))/6e4,c="minute";return b>60&&(b/=60,c="hour",b>24&&(b/=24,c="day")),b=parseInt(b),b+" "+c+(b>1?"s":"")+" ago"},render:function(){var a=this.props.project.tags.map(function(a){return React.createElement("span",{key:a,className:"label label-default"},a)}),b=this.getDate(this.props.project.date);return React.createElement("div",{className:"project-info col-xs-9"},React.createElement("h2",{className:"project-title"},React.createElement("span",{className:"title"},this.props.project.name),React.createElement("div",{className:"project-labels"},a)),React.createElement("div",{className:"posted"},b),React.createElement("p",{className:"project-description"}," ",this.props.project.description.split(".")[0]+"."," "),React.createElement("a",{href:"/project/"+this.props.project._id},React.createElement("div",{className:"more"}," SEE MORE ")),React.createElement(VoteButton,React.__spread({key:this.props.id},this.props)))}}),ProjectList=React.createClass({displayName:"ProjectList",getInitialState:function(){return{votes:{},projects:[],user:{},filter:"",sort:DEFAULT_SORT,pageLimit:DEFAULT_PAGE_LIMIT,currentPage:0}},componentDidMount:function(){$.ajax({url:this.props.url,dataType:"json",cache:!1,success:function(a){this.setState({projects:a.projects,votes:a.votes,user:a.user}),$("#project-filter").keyup(this,function(a){a.data.setState({currentPage:0,filter:$(this).val()})}),$("#sort-method").change(this,function(a){var b=$(this).val();a.data.setState({sort:b})})}.bind(this),error:function(a,b,c){console.error(this.props.url,b,c.toString())}.bind(this)})},handleClick:function(a){this.setState({currentPage:a})},render:function(){var a=this.state.projects,b=(this.state.votes,this.state.user),c=this.state.filter.toLowerCase(),d=this.state.sort,e=this.state.pageLimit,f=this.state.currentPage*e,g=a.filter(function(a){return!c||-1!=a.name.toLowerCase().indexOf(c)||-1!=a.description.toLowerCase().indexOf(c)||-1!=a.tags.join(" ").toLowerCase().indexOf(c)}),h=g.length;g.sort(SORT_OPTIONS[d].bind(this)),g=g.map(function(a,c){var d=this.state.votes[a._id]||[];return React.createElement("div",{className:"project col-xs-12"},React.createElement(ProjectImage,{src:a.images[0]}),React.createElement(ProjectInfo,{key:a._id,project:a,votes:d,user:b}))}.bind(this)).slice(f,f+e);for(var i=[],j=0;h/e>j;j++){var k=j==this.state.currentPage?"active":"";i.push(React.createElement("li",{key:j,className:k,onClick:this.handleClick.bind(this,j)},React.createElement("a",{href:"#!"}," ",j+1," ")))}return g.length>0?React.createElement("div",null,g,React.createElement("nav",null,React.createElement("ul",{className:"pagination"}," ",i,React.createElement("span",{className:"pagination-showing"},"Showing ",f+1," - ",f+g.length," of ",h)))):React.createElement("div",null,React.createElement("h1",null,"No projects found"))}});React.render(React.createElement(ProjectList,{url:"/api/projects"}),document.getElementById("projects-container"));